Calendar=function(){function t(e){e=e||{},this.args=e=E(e,{animation:!nt,cont:null,bottomBar:!0,date:!0,fdow:_("fdow"),min:null,max:null,reverseWheel:!1,selection:[],selectionType:t.SEL_SINGLE,weekNumbers:!1,align:"Bl/ / /T/r",inputField:null,trigger:null,dateFormat:"%Y-%m-%d",opacity:et?1:3,titleFormat:"%b %Y",showTime:!1,timePos:"right",time:!0,minuteStep:5,disabled:dt,checkRange:!1,dateInfo:dt,onChange:dt,onSelect:dt,onTimeChange:dt,onFocus:dt,onBlur:dt}),this.handlers={};var n=this,a=new Date;e.min=k(e.min),e.max=k(e.max),e.date===!0&&(e.date=a),e.time===!0&&(e.time=100*a.getHours()+Math.floor(a.getMinutes()/e.minuteStep)*e.minuteStep),this.date=k(e.date),this.time=e.time,this.fdow=e.fdow,q("onChange onSelect onTimeChange onFocus onBlur".split(/\s+/),function(t){var a=e[t];a instanceof Array||(a=[a]),n.handlers[t]=a}),this.selection=new t.Selection(e.selection,e.selectionType,C,this);var s=l.call(this);e.cont&&J(e.cont).appendChild(s),e.trigger&&this.manageFields(e.trigger,e.inputField,e.dateFormat)}function e(t){var e=["<table",rt,"><tr>"],n=0;for(t.args.weekNumbers&&e.push("<td><div class='DynarchCalendar-weekNumber'>",_("wk"),"</div></td>");n<7;){var a=(n++ +t.fdow)%7;e.push("<td><div",_("weekend").indexOf(a)>=0?" class='DynarchCalendar-weekend'>":">",_("sdn")[a],"</div></td>")}return e.push("</tr></table>"),e.join("")}function n(t,e,n){e=e||t.date,n=n||t.fdow,e=new Date(e.getFullYear(),e.getMonth(),e.getDate(),12,0,0,0);var a=e.getMonth(),s=[],i=0,r=t.args.weekNumbers;e.setDate(1);var o=(e.getDay()-n)%7;o<0&&(o+=7),e.setDate(-o),e.setDate(e.getDate()+1);var l=new Date,h=l.getDate(),c=l.getMonth(),u=l.getFullYear();s[i++]="<table class='DynarchCalendar-bodyTable'"+rt+">";for(var d=0;d<6;++d){s[i++]="<tr class='DynarchCalendar-week",0==d&&(s[i++]=" DynarchCalendar-first-row"),5==d&&(s[i++]=" DynarchCalendar-last-row"),s[i++]="'>",r&&(s[i++]="<td class='DynarchCalendar-first-col'><div class='DynarchCalendar-weekNumber'>"+T(e)+"</div></td>");for(var f=0;f<7;++f){var y=e.getDate(),m=e.getMonth(),p=e.getFullYear(),v=1e4*p+100*(m+1)+y,g=t.selection.isSelected(v),D=t.isDisabled(e);s[i++]="<td class='",0!=f||r||(s[i++]=" DynarchCalendar-first-col"),0==f&&0==d&&(t._firstDateVisible=v),6==f&&(s[i++]=" DynarchCalendar-last-col",5==d&&(t._lastDateVisible=v)),g&&(s[i++]=" DynarchCalendar-td-selected"),s[i++]="'><div dyc-type='date' unselectable='on' dyc-date='"+v+"' ",D&&(s[i++]="disabled='1' "),s[i++]="class='DynarchCalendar-day",_("weekend").indexOf(e.getDay())>=0&&(s[i++]=" DynarchCalendar-weekend"),m!=a&&(s[i++]=" DynarchCalendar-day-othermonth"),y==h&&m==c&&p==u&&(s[i++]=" DynarchCalendar-day-today"),D&&(s[i++]=" DynarchCalendar-day-disabled"),g&&(s[i++]=" DynarchCalendar-day-selected"),D=t.args.dateInfo(e),D&&D.klass&&(s[i++]=" "+D.klass),s[i++]="'>"+y+"</div></td>",e=new Date(p,m,y+1,12,0,0,0)}s[i++]="</tr>"}return s[i++]="</table>",s.join("")}function a(t){var n=["<table class='DynarchCalendar-topCont'",rt,"><tr><td><div class='DynarchCalendar'>",et?"<a class='DynarchCalendar-focusLink' href='#'></a>":"<button class='DynarchCalendar-focusLink'></button>","<div class='DynarchCalendar-topBar'><div dyc-type='nav' dyc-btn='-Y' dyc-cls='hover-navBtn,pressed-navBtn' class='DynarchCalendar-navBtn DynarchCalendar-prevYear'><div></div></div><div dyc-type='nav' dyc-btn='+Y' dyc-cls='hover-navBtn,pressed-navBtn' class='DynarchCalendar-navBtn DynarchCalendar-nextYear'><div></div></div><div dyc-type='nav' dyc-btn='-M' dyc-cls='hover-navBtn,pressed-navBtn' class='DynarchCalendar-navBtn DynarchCalendar-prevMonth'><div></div></div><div dyc-type='nav' dyc-btn='+M' dyc-cls='hover-navBtn,pressed-navBtn' class='DynarchCalendar-navBtn DynarchCalendar-nextMonth'><div></div></div><table class='DynarchCalendar-titleCont'",rt,"><tr><td><div dyc-type='title' dyc-btn='menu' dyc-cls='hover-title,pressed-title' class='DynarchCalendar-title'>",s(t),"</div></td></tr></table><div class='DynarchCalendar-dayNames'>",e(t),"</div></div><div class='DynarchCalendar-body'></div>"];return(t.args.bottomBar||t.args.showTime)&&n.push("<div class='DynarchCalendar-bottomBar'>",o(t),"</div>"),n.push("<div class='DynarchCalendar-menu' style='display: none'>",i(t),"</div><div class='DynarchCalendar-tooltip'></div></div></td></tr></table>"),n.join("")}function s(t){return"<div unselectable='on'>"+S(t.date,t.args.titleFormat)+"</div>"}function i(t){for(var e,n=["<table height='100%'",rt,"><tr><td><table style='margin-top: 1.5em'",rt,"><tr><td colspan='3'><input dyc-btn='year' class='DynarchCalendar-menu-year' size='6' value='",t.date.getFullYear(),"' /></td></tr><tr><td><div dyc-type='menubtn' dyc-cls='hover-navBtn,pressed-navBtn' dyc-btn='today'>",_("goToday"),"</div></td></tr></table><p class='DynarchCalendar-menu-sep'>&nbsp;</p><table class='DynarchCalendar-menu-mtable'",rt,">"],a=_("smn"),s=0,i=n.length;s<12;){for(n[i++]="<tr>",e=4;--e>0;)n[i++]="<td><div dyc-type='menubtn' dyc-cls='hover-navBtn,pressed-navBtn' dyc-btn='m"+s+"' class='DynarchCalendar-menu-month'>"+a[s++]+"</div></td>";n[i++]="</tr>"}return n[i++]="</table></td></tr></table>",n.join("")}function r(t,e){e.push("<table class='DynarchCalendar-time'"+rt+"><tr><td rowspan='2'><div dyc-type='time-hour' dyc-cls='hover-time,pressed-time' class='DynarchCalendar-time-hour'></div></td><td dyc-type='time-hour+' dyc-cls='hover-time,pressed-time' class='DynarchCalendar-time-up'></td><td rowspan='2' class='DynarchCalendar-time-sep'></td><td rowspan='2'><div dyc-type='time-min' dyc-cls='hover-time,pressed-time' class='DynarchCalendar-time-minute'></div></td><td dyc-type='time-min+' dyc-cls='hover-time,pressed-time' class='DynarchCalendar-time-up'></td>"),12==t.args.showTime&&e.push("<td rowspan='2' class='DynarchCalendar-time-sep'></td><td rowspan='2'><div class='DynarchCalendar-time-am' dyc-type='time-am' dyc-cls='hover-time,pressed-time'></div></td>"),e.push("</tr><tr><td dyc-type='time-hour-' dyc-cls='hover-time,pressed-time' class='DynarchCalendar-time-down'></td><td dyc-type='time-min-' dyc-cls='hover-time,pressed-time' class='DynarchCalendar-time-down'></td></tr></table>")}function o(t){function e(){a.showTime&&(n.push("<td>"),r(t,n),n.push("</td>"))}var n=[],a=t.args;return n.push("<table",rt," style='width:100%'><tr>"),"left"==a.timePos&&e(),a.bottomBar&&(n.push("<td>"),n.push("<table",rt,"><tr><td><div dyc-btn='today' dyc-cls='hover-bottomBar-today,pressed-bottomBar-today' dyc-type='bottomBar-today' class='DynarchCalendar-bottomBar-today'>",_("today"),"</div></td></tr></table>"),n.push("</td>")),"right"==a.timePos&&e(),n.push("</tr></table>"),n.join("")}function l(){var t=V("div"),e=this.els={},n={mousedown:O(m,this,!0),mouseup:O(m,this,!1),mouseover:O(D,this,!0),mouseout:O(D,this,!1),keypress:O(w,this)};return n[at?"DOMMouseScroll":"mousewheel"]=O(b,this),et&&(n.dblclick=n.mousedown,n.keydown=n.keypress),t.innerHTML=a(this),W(t.firstChild,function(t){var n=ot[t.className];n&&(e[n]=t),et&&t.setAttribute("unselectable","on")}),B(e.main,n),B([e.focusLink,e.yearInput],this._focusEvents={focus:O(h,this),blur:O(u,this)}),this.moveTo(this.date,!1),this.setTime(null,!0),e.topCont}function h(){this._bluringTimeout&&clearTimeout(this._bluringTimeout),this.focused=!0,P(this.els.main,"DynarchCalendar-focused"),this.callHooks("onFocus",this)}function c(){this.focused=!1,F(this.els.main,"DynarchCalendar-focused"),this._menuVisible&&y(this,!1),this.args.cont||this.hide(),this.callHooks("onBlur",this)}function u(){this._bluringTimeout=setTimeout(O(c,this),50)}function d(t){switch(t){case"time-hour+":this.setHours(this.getHours()+1);break;case"time-hour-":this.setHours(this.getHours()-1);break;case"time-min+":this.setMinutes(this.getMinutes()+this.args.minuteStep);break;case"time-min-":this.setMinutes(this.getMinutes()-this.args.minuteStep);break;default:return}}function f(t,e,n){this._bodyAnim&&this._bodyAnim.stop();var a;if(0!=e)switch(a=new Date(t.date),a.setDate(1),e){case"-Y":case-2:a.setFullYear(a.getFullYear()-1);break;case"+Y":case 2:a.setFullYear(a.getFullYear()+1);break;case"-M":case-1:a.setMonth(a.getMonth()-1);break;case"+M":case 1:a.setMonth(a.getMonth()+1)}else a=new Date;return t.moveTo(a,!n)}function y(t,e){t._menuVisible=e,R(e,t.els.title,"DynarchCalendar-pressed-title");var n=t.els.menu;if(nt&&(n.style.height=t.els.main.offsetHeight+"px"),t.args.animation){t._menuAnim&&t._menuAnim.stop();var a=t.els.main.offsetHeight;nt&&(n.style.width=t.els.topBar.offsetWidth+"px"),e&&(n.firstChild.style.marginTop=-a+"px",t.args.opacity>0&&$(n,0),j(n,!0)),t._menuAnim=K({onUpdate:function(s,i){n.firstChild.style.marginTop=i(ut.accel_b(s),-a,0,!e)+"px",t.args.opacity>0&&$(n,i(ut.accel_b(s),0,.85,!e))},onStop:function(){t.args.opacity>0&&$(n,.85),n.firstChild.style.marginTop="",t._menuAnim=null,e||(j(n,!1),t.focused&&t.focus())}})}else j(n,e),t.focused&&t.focus()}function m(e,n){n=n||window.event;var a=v(n);if(a&&!a.getAttribute("disabled")){var s,i=a.getAttribute("dyc-btn"),r=a.getAttribute("dyc-type"),o=a.getAttribute("dyc-date"),l=this.selection,h={mouseover:N,mousemove:N,mouseup:function(t){var e=a.getAttribute("dyc-cls");e&&F(a,g(e,1)),clearTimeout(s),Y(document,h,!0),h=null}};if(e){setTimeout(O(this.focus,this),1);var c=a.getAttribute("dyc-cls");if(c&&P(a,g(c,1)),"menu"==i)this.toggleMenu();else if(a&&/^[+-][MY]$/.test(i))if(f(this,i)){var u=O(function(){f(this,i,!0)?s=setTimeout(u,40):(h.mouseup(),f(this,i))},this);s=setTimeout(u,350),B(document,h,!0)}else h.mouseup();else if("year"==i)this.els.yearInput.focus(),this.els.yearInput.select();else if("time-am"==r)B(document,h,!0);else if(/^time/.test(r)){var u=O(function(t){d.call(this,t),s=setTimeout(u,100)},this,r);d.call(this,r),s=setTimeout(u,350),B(document,h,!0)}else o&&l.type&&(l.type==t.SEL_MULTIPLE?n.shiftKey&&this._selRangeStart?l.selectRange(this._selRangeStart,o):(n.ctrlKey||l.isSelected(o)||l.clear(!0),l.set(o,!0),this._selRangeStart=o):(l.set(o),this.moveTo(A(o),2)),a=this._getDateDiv(o),D.call(this,!0,{target:a})),B(document,h,!0);et&&h&&/dbl/i.test(n.type)&&h.mouseup(),/^(DynarchCalendar-(topBar|bottomBar|weekend|weekNumber|menu(-sep)?))?$/.test(a.className)&&!this.args.cont&&(h.mousemove=O(p,this),this._mouseDiff=z(n,G(this.els.topCont)),B(document,h,!0))}else if("today"==i)this._menuVisible||l.type!=t.SEL_SINGLE||l.set(new Date),this.moveTo(new Date,!0),y(this,!1);else if(/^m([0-9]+)/.test(i)){var o=new Date(this.date);o.setDate(1),o.setMonth(RegExp.$1),o.setFullYear(this._getInputYear()),this.moveTo(o,!0),y(this,!1)}else"time-am"==r&&this.setHours(this.getHours()+12);et||N(n)}}function p(t){t=t||window.event;var e=this.els.topCont.style,n=z(t,this._mouseDiff);e.left=n.x+"px",e.top=n.y+"px"}function v(t){for(var e=t.target||t.srcElement,n=e;e&&e.getAttribute&&!e.getAttribute("dyc-type");)e=e.parentNode;return e.getAttribute&&e||n}function g(t,e){return"DynarchCalendar-"+t.split(/,/)[e]}function D(t,e){e=e||window.event;var n=v(e);if(n){var a=n.getAttribute("dyc-type");if(a&&!n.getAttribute("disabled")&&(!t||!this._bodyAnim||"date"!=a)){var s=n.getAttribute("dyc-cls");s=s?g(s,0):"DynarchCalendar-hover-"+a,("date"!=a||this.selection.type)&&R(t,n,s),"date"==a&&(R(t,n.parentNode.parentNode,"DynarchCalendar-hover-week"),this._showTooltip(n.getAttribute("dyc-date"))),/^time-hour/.test(a)&&R(t,this.els.timeHour,"DynarchCalendar-hover-time"),/^time-min/.test(a)&&R(t,this.els.timeMinute,"DynarchCalendar-hover-time"),F(this._getDateDiv(this._lastHoverDate),"DynarchCalendar-hover-date"),this._lastHoverDate=null}}t||this._showTooltip()}function b(t){t=t||window.event;var e=v(t);if(e){var n=e.getAttribute("dyc-btn"),a=e.getAttribute("dyc-type"),s=t.wheelDelta?t.wheelDelta/120:-t.detail/3;if(s=s<0?-1:s>0?1:0,this.args.reverseWheel&&(s=-s),/^(time-(hour|min))/.test(a)){switch(RegExp.$1){case"time-hour":this.setHours(this.getHours()+s);break;case"time-min":this.setMinutes(this.getMinutes()+this.args.minuteStep*s)}N(t)}else/Y/i.test(n)&&(s*=2),f(this,-s),N(t)}}function C(){this.refresh();var t=this.inputField,e=this.selection;if(t){var n=e.print(this.dateFormat);/input|textarea/i.test(t.tagName)?t.value=n:t.innerHTML=n}this.callHooks("onSelect",this,e)}function w(e){if(!this._menuAnim){e=e||window.event;var n=e.target||e.srcElement,a=n.getAttribute("dyc-btn"),s=e.keyCode,i=e.charCode||s,r=ht[s];if("year"==a&&13==s){var o=new Date(this.date);return o.setDate(1),o.setFullYear(this._getInputYear()),this.moveTo(o,!0),y(this,!1),N(e)}if(this._menuVisible){if(27==s)return y(this,!1),N(e)}else{if(e.ctrlKey||(r=null),null!=r||e.ctrlKey||(r=ct[s]),36==s&&(r=0),null!=r)return f(this,r),N(e);i=String.fromCharCode(i).toLowerCase();var l=this.els.yearInput,h=this.selection;if(" "==i)return y(this,!0),this.focus(),l.focus(),l.select(),N(e);if(i>="0"&&i<="9")return y(this,!0),this.focus(),l.value=i,l.focus(),N(e);for(var c,u=_("mn"),d=e.shiftKey?-1:this.date.getMonth(),m=0;++m<12;)if(c=u[(d+m)%12].toLowerCase(),0==c.indexOf(i)){var o=new Date(this.date);return o.setDate(1),o.setMonth((d+m)%12),this.moveTo(o,!0),N(e)}if(s>=37&&s<=40){var o=this._lastHoverDate;if(o||h.isEmpty()||(o=s<39?h.getFirstDate():h.getLastDate(),(o<this._firstDateVisible||o>this._lastDateVisible)&&(o=null)),o){var p=o;o=A(o);for(var d=100;d-- >0;){switch(s){case 37:o.setDate(o.getDate()-1);break;case 38:o.setDate(o.getDate()-7);break;case 39:o.setDate(o.getDate()+1);break;case 40:o.setDate(o.getDate()+7)}if(!this.isDisabled(o))break}o=L(o),(o<this._firstDateVisible||o>this._lastDateVisible)&&this.moveTo(o)}else o=s<39?this._lastDateVisible:this._firstDateVisible;return F(this._getDateDiv(p),P(this._getDateDiv(o),"DynarchCalendar-hover-date")),this._lastHoverDate=o,N(e)}if(13==s&&this._lastHoverDate)return h.type==t.SEL_MULTIPLE&&(e.shiftKey||e.ctrlKey)?(e.shiftKey&&this._selRangeStart&&(h.clear(!0),h.selectRange(this._selRangeStart,this._lastHoverDate)),e.ctrlKey&&h.set(this._selRangeStart=this._lastHoverDate,!0)):h.reset(this._selRangeStart=this._lastHoverDate),N(e);27!=s||this.args.cont||this.hide()}}}function M(t,e){return t.replace(/\$\{([^:\}]+)(:[^\}]+)?\}/g,function(t,n,a){var s,i=e[n];return a&&(s=a.substr(1).split(/\s*\|\s*/),i=(i>=s.length?s[s.length-1]:s[i]).replace(/##?/g,function(t){return 2==t.length?"#":i})),i})}function _(t,e){var n=it.__.data[t];return e&&"string"==typeof n&&(n=M(n,e)),n}function T(t){t=new Date(t.getFullYear(),t.getMonth(),t.getDate(),12,0,0);var e=t.getDay();t.setDate(t.getDate()-(e+6)%7+3);var n=t.valueOf();return t.setMonth(0),t.setDate(4),Math.round((n-t.valueOf())/6048e5)+1}function x(t){t=new Date(t.getFullYear(),t.getMonth(),t.getDate(),12,0,0);var e=new Date(t.getFullYear(),0,1,12,0,0),n=t-e;return Math.floor(n/864e5)}function L(t){return t instanceof Date?1e4*t.getFullYear()+100*(t.getMonth()+1)+t.getDate():"string"==typeof t?parseInt(t,10):t}function A(t,e,n,a,s){if(!(t instanceof Date)){t=parseInt(t,10);var i=Math.floor(t/1e4);t%=1e4;var r=Math.floor(t/100);t%=100,t=new Date(i,r-1,t,e||12,n||0,a||0,s||0)}return t}function H(t,e,n){var a=t.getFullYear(),s=t.getMonth(),i=t.getDate(),r=e.getFullYear(),o=e.getMonth(),l=e.getDate();return a<r?-3:a>r?3:s<o?-2:s>o?2:n?0:i<l?-1:i>l?1:0}function S(t,e){var n,a=t.getMonth(),s=t.getDate(),i=t.getFullYear(),r=T(t),o=t.getDay(),l=t.getHours(),h=l>=12,c=h?l-12:l,u=x(t),d=t.getMinutes(),f=t.getSeconds(),y=/%./g;return 0===c&&(c=12),n={"%a":_("sdn")[o],"%A":_("dn")[o],"%b":_("smn")[a],"%B":_("mn")[a],"%C":1+Math.floor(i/100),"%d":s<10?"0"+s:s,"%e":s,"%H":l<10?"0"+l:l,"%I":c<10?"0"+c:c,"%j":u<10?"00"+u:u<100?"0"+u:u,"%k":l,"%l":c,"%m":a<9?"0"+(1+a):1+a,"%o":1+a,"%M":d<10?"0"+d:d,"%n":"\n","%p":h?"PM":"AM","%P":h?"pm":"am","%s":Math.floor(t.getTime()/1e3),"%S":f<10?"0"+f:f,"%t":"\t","%U":r<10?"0"+r:r,"%W":r<10?"0"+r:r,"%V":r<10?"0"+r:r,"%u":o+1,"%w":o,"%y":(""+i).substr(2,2),"%Y":i,"%%":"%"},e.replace(y,function(t){return n.hasOwnProperty(t)?n[t]:t})}function k(t){if(t){if("number"==typeof t)return A(t);if(!(t instanceof Date)){var e=t.split(/-/);return new Date(parseInt(e[0],10),parseInt(e[1],10)-1,parseInt(e[2],10),12,0,0,0)}}return t}function I(t){function e(e){for(var n=e.length;--n>=0;)if(0==e[n].toLowerCase().indexOf(t))return n}if(/\S/.test(t)){t=t.toLowerCase();var n=e(_("smn"))||e(_("mn"));return null!=n&&n++,n}}function E(t,e,n,a){a={};for(n in e)e.hasOwnProperty(n)&&(a[n]=e[n]);for(n in t)t.hasOwnProperty(n)&&(a[n]=t[n]);return a}function B(t,e,n,a){if(t instanceof Array)for(var s=t.length;--s>=0;)B(t[s],e,n,a);else if("object"==typeof e)for(var s in e)e.hasOwnProperty(s)&&B(t,s,e[s],n);else t.addEventListener?t.addEventListener(e,n,!!et||!!a):t.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n}function Y(t,e,n,a){if(t instanceof Array)for(var s=t.length;--s>=0;)Y(t[s],e,n);else if("object"==typeof e)for(var s in e)e.hasOwnProperty(s)&&Y(t,s,e[s],n);else t.removeEventListener?t.removeEventListener(e,n,!!et||!!a):t.detachEvent?t.detachEvent("on"+e,n):t["on"+e]=null}function N(t){return t=t||window.event,et?(t.cancelBubble=!0,t.returnValue=!1):(t.preventDefault(),t.stopPropagation()),!1}function F(t,e,n){if(t){var a,s=t.className.replace(/^\s+|\s+$/,"").split(/\x20/),i=[];for(a=s.length;a>0;)s[--a]!=e&&i.push(s[a]);n&&i.push(n),t.className=i.join(" ")}return n}function P(t,e){return F(t,e,e)}function R(t,e,n){if(e instanceof Array)for(var a=e.length;--a>=0;)R(t,e[a],n);else F(e,n,t?n:null);return t}function V(t,e,n){var a=null;return a=document.createElementNS?document.createElementNS("http://www.w3.org/1999/xhtml",t):document.createElement(t),e&&(a.className=e),n&&n.appendChild(a),a}function U(t,e){null==e&&(e=0);var n,a,s;try{n=Array.prototype.slice.call(t,e)}catch(i){for(n=new Array(t.length-e),a=e,s=0;a<t.length;++a,++s)n[s]=t[a]}return n}function O(t,e){var n=U(arguments,2);return void 0==e?function(){return t.apply(this,n.concat(U(arguments)))}:function(){return t.apply(e,n.concat(U(arguments)))}}function W(t,e){if(!e(t))for(var n=t.firstChild;n;n=n.nextSibling)1==n.nodeType&&W(n,e)}function K(t,e,n){function a(t,e,n,a){return a?n+t*(e-n):e+t*(n-e)}function s(){e&&i(),n=0,e=setInterval(r,1e3/t.fps)}function i(){e&&(clearInterval(e),e=null),t.onStop(n/t.len,a)}function r(){var e=t.len;t.onUpdate(n/e,a),n==e&&i(),++n}return t=E(t,{fps:50,len:15,onUpdate:dt,onStop:dt}),et&&(t.len=Math.round(t.len/2)),s(),{start:s,stop:i,update:r,args:t,map:a}}function $(t,e){return""===e?et?t.style.filter="":t.style.opacity="":null!=e?et?t.style.filter="alpha(opacity="+100*e+")":t.style.opacity=e:et?/alpha\(opacity=([0-9.])+\)/.test(t.style.opacity)&&(e=parseFloat(RegExp.$1)/100):e=parseFloat(t.style.opacity),e}function j(t,e){var n=t.style;return null!=e&&(n.display=e?"":"none"),"none"!=n.display}function z(t,e){var n=et?t.clientX+document.body.scrollLeft:t.pageX,a=et?t.clientY+document.body.scrollTop:t.pageY;return e&&(n-=e.x,a-=e.y),{x:n,y:a}}function G(t){var e,n,a=0,s=0,i=/^div$/i.test(t.tagName);return i&&t.scrollLeft&&(a=t.scrollLeft),i&&t.scrollTop&&(s=t.scrollTop),e={x:t.offsetLeft-a,y:t.offsetTop-s},t.offsetParent&&(n=G(t.offsetParent),e.x+=n.x,e.y+=n.y),e}function X(){var t=document.documentElement,e=document.body;return{x:t.scrollLeft||e.scrollLeft,y:t.scrollTop||e.scrollTop,w:t.clientWidth||window.innerWidth||e.clientWidth,h:t.clientHeight||window.innerHeight||e.clientHeight}}function q(t,e,n){for(n=0;n<t.length;++n)e(t[n])}function J(t){return"string"==typeof t&&(t=document.getElementById(t)),t}var Q=navigator.userAgent,Z=/opera/i.test(Q),tt=/Konqueror|Safari|KHTML/i.test(Q),et=/msie/i.test(Q)&&!Z&&!/mac_powerpc/i.test(Q),nt=et&&/msie 6/i.test(Q),at=/gecko/i.test(Q)&&!tt&&!Z&&!et,st=t.prototype,it=t.I18N={};t.SEL_NONE=0,t.SEL_SINGLE=1,t.SEL_MULTIPLE=2,t.SEL_WEEK=3,t.dateToInt=L,t.intToDate=A,t.printDate=S,t.formatString=M,t.i18n=_,t.LANG=function(t,e,n){it.__=it[t]={name:e,data:n}},t.setup=function(e){return new t(e)},st.moveTo=function(t,e){t=k(t);var a,s=H(t,this.date,!0),i=this.args,r=i.min&&H(t,i.min),o=i.max&&H(t,i.max);if(i.showTime&&(this.setHours(t.getUTCHours()),this.setMinutes(t.getUTCMinutes())),i.animation||(e=!1),R(null!=r&&r<=1,[this.els.navPrevMonth,this.els.navPrevYear],"DynarchCalendar-navDisabled"),R(null!=o&&o>=-1,[this.els.navNextMonth,this.els.navNextYear],"DynarchCalendar-navDisabled"),r<-1&&(t=i.min,a=1,s=0),o>1&&(t=i.max,a=2,s=0),this.date=t,this.refresh(!!e),this.callHooks("onChange",this,t,e),e&&(0!=s||2!=e)){this._bodyAnim&&this._bodyAnim.stop();var l=this.els.body,h=V("div","DynarchCalendar-animBody-"+lt[s],l),c=l.firstChild,u=($(c)||.7,a?ut.brakes:0==s?ut.shake:ut.accel_ab2),d=s*s>4,f=d?c.offsetTop:c.offsetLeft,y=h.style,m=d?l.offsetHeight:l.offsetWidth;if(s<0?m+=f:s>0?m=f-m:(m=Math.round(m/7),2==a&&(m=-m)),!a&&0!=s){var p=h.cloneNode(!0),v=p.style,g=2*m;p.appendChild(c.cloneNode(!0)),v[d?"marginTop":"marginLeft"]=m+"px",l.appendChild(p)}c.style.visibility="hidden",h.innerHTML=n(this),this._bodyAnim=K({onUpdate:O(function(t,e){var n=u(t);if(p)var i=e(n,m,g)+"px";a?y[d?"marginTop":"marginLeft"]=e(n,m,0)+"px":((d||0==s)&&(y.marginTop=e(0==s?u(t*t):n,0,m)+"px",0!=s&&(v.marginTop=i)),d&&0!=s||(y.marginLeft=e(n,0,m)+"px",0!=s&&(v.marginLeft=i))),this.args.opacity>2&&p&&($(p,1-n),$(h,n))},this),onStop:O(function(e){l.innerHTML=n(this,t),this._bodyAnim=null},this)})}return this._lastHoverDate=null,r>=-1&&o<=1},st.isDisabled=function(t){var e=this.args;return e.min&&H(t,e.min)<0||e.max&&H(t,e.max)>0||e.disabled(t)},st.toggleMenu=function(){y(this,!this._menuVisible)},st.refresh=function(t){var e=this.els;t||(e.body.innerHTML=n(this)),e.title.innerHTML=s(this),e.yearInput.value=this.date.getFullYear()},st.redraw=function(){var t=this.els;this.refresh(),t.dayNames.innerHTML=e(this),t.menu.innerHTML=i(this),t.bottomBar&&(t.bottomBar.innerHTML=o(this)),W(t.topCont,O(function(e){var n=ot[e.className];n&&(t[n]=e),"DynarchCalendar-menu-year"==e.className?(B(e,this._focusEvents),t.yearInput=e):et&&e.setAttribute("unselectable","on")},this)),this.setTime(null,!0)},st.setLanguage=function(e){var n=t.setLanguage(e);n&&(this.fdow=n.data.fdow,this.redraw())},t.setLanguage=function(t){var e=it[t];return e&&(it.__=e),e},st.focus=function(){try{this.els[this._menuVisible?"yearInput":"focusLink"].focus()}catch(t){}h.call(this)},st.blur=function(){this.els.focusLink.blur(),this.els.yearInput.blur(),c.call(this)},st.showAt=function(t,e,n){this._showAnim&&this._showAnim.stop(),n=n&&this.args.animation;var a=this.els.topCont,s=this,i=this.els.body.firstChild,r=i.offsetHeight,o=a.style;o.position="absolute",o.left=t+"px",o.top=e+"px",o.zIndex=1e4,o.display="",n&&(i.style.marginTop=-r+"px",this.args.opacity>1&&$(a,0),this._showAnim=K({onUpdate:function(t,e){i.style.marginTop=-e(ut.accel_b(t),r,0)+"px",s.args.opacity>1&&$(a,t)},onStop:function(){s.args.opacity>1&&$(a,""),s._showAnim=null}}))},st.hide=function(){var t=this.els.topCont,e=this,n=this.els.body.firstChild,a=n.offsetHeight,s=G(t).y;this.args.animation?(this._showAnim&&this._showAnim.stop(),this._showAnim=K({onUpdate:function(i,r){e.args.opacity>1&&$(t,1-i),n.style.marginTop=-r(ut.accel_b(i),0,a)+"px",t.style.top=r(ut.accel_ab(i),s,s-10)+"px"},onStop:function(){t.style.display="none",n.style.marginTop="",e.args.opacity>1&&$(t,""),e._showAnim=null}})):t.style.display="none",this.inputField=null},st.popup=function(t,e){function n(e){var n={x:l.x,y:l.y};return e?(/B/.test(e)&&(n.y+=t.offsetHeight),/b/.test(e)&&(n.y+=t.offsetHeight-a.y),/T/.test(e)&&(n.y-=a.y),/l/.test(e)&&(n.x-=a.x-t.offsetWidth),/L/.test(e)&&(n.x-=a.x),/R/.test(e)&&(n.x+=t.offsetWidth),/c/i.test(e)&&(n.x+=(t.offsetWidth-a.x)/2),/m/i.test(e)&&(n.y+=(t.offsetHeight-a.y)/2),n):n}t=J(t),e||(e=this.args.align),e=e.split(/\x2f/);var a,s=G(t),i=this.els.topCont,r=i.style,o=X();r.visibility="hidden",r.display="",this.showAt(0,0),document.body.appendChild(i),a={x:i.offsetWidth,y:i.offsetHeight};var l=s;l=n(e[0]),l.y<o.y&&(l.y=s.y,l=n(e[1])),l.x+a.x>o.x+o.w&&(l.x=s.x,l=n(e[2])),l.y+a.y>o.y+o.h&&(l.y=s.y,l=n(e[3])),l.x<o.x&&(l.x=s.x,l=n(e[4])),this.showAt(l.x,l.y,!0),r.visibility="",this.focus()},st.manageFields=function(e,n,a){n=J(n),B(J(e),"click",O(function(){if(this.inputField=n,this.dateFormat=a,this.selection.type==t.SEL_SINGLE){var s,i,r,o;s=/input|textarea/i.test(n.tagName)?n.value:n.innerText||n.textContent,s&&(i=/(^|[^%])%[bBmo]/.exec(a),r=/(^|[^%])%[de]/.exec(a),i&&r&&(o=i.index<r.index),s=Calendar.parseDate(s,o),s&&(this.selection.set(s,!1,!0),this.moveTo(s)))}this.popup(e)},this))},st.callHooks=function(t){for(var e=U(arguments,1),n=this.handlers[t],a=0;a<n.length;++a)n[a].apply(this,e)},st.addEventListener=function(t,e){this.handlers[t].push(e)},st.removeEventListener=function(t,e){for(var n=this.handlers[t],a=n.length;--a>=0;)n[a]===e&&n.splice(a,1)},st.getTime=function(){return this.time},st.setTime=function(t,e){if(this.args.showTime){t=this.time=null!=t?t:this.time;var n=this.getHours(),a=this.getMinutes(),s=n<12;12==this.args.showTime&&(0==n&&(n=12),n>12&&(n-=12),this.els.timeAM.innerHTML=_(s?"AM":"PM")),n<10&&(n="0"+n),a<10&&(a="0"+a),this.els.timeHour.innerHTML=n,this.els.timeMinute.innerHTML=a,e||this.callHooks("onTimeChange",this,t)}},st.getHours=function(){return Math.floor(this.time/100)},st.getMinutes=function(){return this.time%100},st.setHours=function(t){t<0&&(t+=24),this.setTime(100*(t%24)+this.time%100)},st.setMinutes=function(t){t<0&&(t+=60),this.setTime(100*this.getHours()+t%60)},st._getInputYear=function(){var t=parseInt(this.els.yearInput.value,10);return isNaN(t)&&(t=this.date.getFullYear()),t},st._showTooltip=function(t){var e,n="",a=this.els.tooltip;t&&(t=A(t),e=this.args.dateInfo(t),e&&e.tooltip&&(n="<div class='DynarchCalendar-tooltipCont'>"+S(t,e.tooltip)+"</div>")),a.innerHTML=n};var rt=" align='center' cellspacing='0' cellpadding='0'",ot={"DynarchCalendar-topCont":"topCont","DynarchCalendar-focusLink":"focusLink",DynarchCalendar:"main","DynarchCalendar-topBar":"topBar","DynarchCalendar-title":"title","DynarchCalendar-dayNames":"dayNames","DynarchCalendar-body":"body","DynarchCalendar-menu":"menu","DynarchCalendar-menu-year":"yearInput","DynarchCalendar-bottomBar":"bottomBar","DynarchCalendar-tooltip":"tooltip","DynarchCalendar-time-hour":"timeHour","DynarchCalendar-time-minute":"timeMinute","DynarchCalendar-time-am":"timeAM","DynarchCalendar-navBtn DynarchCalendar-prevYear":"navPrevYear","DynarchCalendar-navBtn DynarchCalendar-nextYear":"navNextYear","DynarchCalendar-navBtn DynarchCalendar-prevMonth":"navPrevMonth","DynarchCalendar-navBtn DynarchCalendar-nextMonth":"navNextMonth"},lt={"-3":"backYear","-2":"back",0:"now",2:"fwd",3:"fwdYear"},ht={37:-1,38:-2,39:1,40:2},ct={33:-1,34:1};st._getDateDiv=function(t){var e=null;if(t)try{W(this.els.body,function(n){if(n.getAttribute("dyc-date")==t)throw e=n})}catch(n){}return e},(t.Selection=function(t,e,n,a){this.type=e,this.sel=t instanceof Array?t:[t],this.onChange=O(n,a),this.cal=a}).prototype={get:function(){return this.type==t.SEL_SINGLE?this.sel[0]:this.sel},isEmpty:function(){return 0==this.sel.length},set:function(e,n,a){var s=this.type==t.SEL_SINGLE;e instanceof Array?(this.sel=e,this.normalize(),a||this.onChange(this)):(e=L(e),s||!this.isSelected(e)?(s?this.sel=[e]:this.sel.splice(this.findInsertPos(e),0,e),this.normalize(),a||this.onChange(this)):n&&this.unselect(e,a))},reset:function(){this.sel=[],this.set.apply(this,arguments)},countDays:function(){for(var t,e,n,a=0,s=this.sel,i=s.length;--i>=0;)t=s[i],t instanceof Array&&(e=A(t[0]),n=A(t[1]),a+=Math.round(Math.abs(n.getTime()-e.getTime())/864e5)),++a;return a},unselect:function(t,e){t=L(t);for(var n,a=!1,s=this.sel,i=s.length;--i>=0;)if(n=s[i],n instanceof Array){if(t>=n[0]&&t<=n[1]){var r=A(t),o=r.getDate();if(t==n[0])r.setDate(o+1),n[0]=L(r),a=!0;else if(t==n[1])r.setDate(o-1),n[1]=L(r),a=!0;else{var l=new Date(r);l.setDate(o+1),r.setDate(o-1),s.splice(i+1,0,[L(l),n[1]]),n[1]=L(r),a=!0}}}else t==n&&(s.splice(i,1),a=!0);a&&(this.normalize(),e||this.onChange(this))},normalize:function(){this.sel=this.sel.sort(function(t,e){return t instanceof Array&&(t=t[0]),e instanceof Array&&(e=e[0]),t-e});for(var t,e,n=this.sel,a=n.length;--a>=0;){if(t=n[a],t instanceof Array){if(t[0]>t[1]){n.splice(a,1);continue}t[0]==t[1]&&(t=n[a]=t[0])}if(e){var s=e,i=t instanceof Array?t[1]:t;if(i=A(i),i.setDate(i.getDate()+1),i=L(i),i>=s){var r=n[a+1];t instanceof Array&&r instanceof Array?(t[1]=r[1],n.splice(a+1,1)):t instanceof Array?(t[1]=e,n.splice(a+1,1)):r instanceof Array?(r[0]=t,n.splice(a,1)):(n[a]=[t,r],n.splice(a+1,1))}}e=t instanceof Array?t[0]:t}},findInsertPos:function(t){for(var e,n=this.sel,a=n.length;--a>=0&&(e=n[a],e instanceof Array&&(e=e[0]),!(e<=t)););return a+1},clear:function(t){this.sel=[],t||this.onChange(this)},selectRange:function(e,n){if(e=L(e),n=L(n),e>n){var a=e;e=n,n=a}var s=this.cal.args.checkRange;if(!s)return this._do_selectRange(e,n);try{q(new t.Selection([[e,n]],t.SEL_MULTIPLE,dt).getDates(),O(function(t){if(this.isDisabled(t))throw s instanceof Function&&s(t,this),"OUT"},this.cal)),this._do_selectRange(e,n)}catch(i){}},_do_selectRange:function(t,e){this.sel.push([t,e]),this.normalize(),this.onChange(this)},isSelected:function(t){for(var e,n=this.sel.length;--n>=0;)if(e=this.sel[n],e instanceof Array&&t>=e[0]&&t<=e[1]||t==e)return!0;return!1},getFirstDate:function(){var t=this.sel[0];return t&&t instanceof Array&&(t=t[0]),t},getLastDate:function(){if(this.sel.length>0){var t=this.sel[this.sel.length-1];return t&&t instanceof Array&&(t=t[1]),t}},print:function(t,e){var n,a=[],s=0,i=this.cal.getHours(),r=this.cal.getMinutes();for(e||(e=" -> ");s<this.sel.length;)n=this.sel[s++],n instanceof Array?a.push(S(A(n[0],i,r),t)+e+S(A(n[1],i,r),t)):a.push(S(A(n,i,r),t));return a},getDates:function(t){for(var e,n,a=[],s=0;s<this.sel.length;){if(n=this.sel[s++],n instanceof Array)for(e=A(n[0]),n=n[1];L(e)<n;)a.push(t?S(e,t):new Date(e)),e.setDate(e.getDate()+1);else e=A(n);a.push(t?S(e,t):e)}return a}},t.parseDate=function(t,e,n){if(!/\S/.test(t))return"";t=t.replace(/^\s+/,"").replace(/\s+$/,""),n=n||new Date;var a=null,s=null,i=null,r=null,o=null,l=null,h=t.match(/([0-9]{1,2}):([0-9]{1,2})(:[0-9]{1,2})?\s*(am|pm)?/i);h&&(r=parseInt(h[1],10),o=parseInt(h[2],10),l=h[3]?parseInt(h[3].substr(1),10):0,t=t.substring(0,h.index)+t.substr(h.index+h[0].length),h[4]&&("pm"==h[4].toLowerCase()&&r<12?r+=12:"am"==h[4].toLowerCase()&&r>=12&&(r-=12)));for(var c=t.split(/\W+/),u=[],d=0;d<c.length;++d){var f=c[d];/^[0-9]{4}$/.test(f)?(a=parseInt(f,10),s||i||null!=e||(e=!0)):/^[0-9]{1,2}$/.test(f)?(f=parseInt(f,10),f>=60?a=f:f>=0&&f<=12?u.push(f):f>=1&&f<=31&&(i=f)):s=I(f)}return u.length>=2?e?(s||(s=u.shift()),i||(i=u.shift())):(i||(i=u.shift()),s||(s=u.shift())):1==u.length&&(i?s||(s=u.shift()):i=u.shift()),a||(a=u.length>0?u.shift():n.getFullYear()),a<30?a+=2e3:a<99&&(a+=1900),s||(s=n.getMonth()+1),a&&s&&i?new Date(Date.UTC(a,s-1,i,r,o,l)):null};var ut={elastic_b:function(t){return 1-Math.cos(5.5*-t*Math.PI)/Math.pow(2,7*t)},magnetic:function(t){return 1-Math.cos(t*t*t*10.5*Math.PI)/Math.exp(4*t)},accel_b:function(t){return t=1-t,1-t*t*t*t},accel_a:function(t){return t*t*t},accel_ab:function(t){return t=1-t,1-Math.sin(t*t*Math.PI/2)},accel_ab2:function(t){return(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1)},brakes:function(t){return t=1-t,1-Math.sin(t*t*Math.PI)},shake:function(t){return t<.5?-Math.cos(11*t*Math.PI)*t*t:(t=1-t,Math.cos(11*t*Math.PI)*t*t)}},dt=new Function;return t}();
//# sourceMappingURL=maps/calendar.js.map
